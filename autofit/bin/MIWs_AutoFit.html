<!DOCTYPE html>
<html>
<body>

<h1> <span style="background-color:rgb(255, 255, 255)">
MIW's AutoFit by Matthew Inglis-Whalen
</span> </h1>

<textarea id = "text_area" rows="20" cols="80" placeholder="Paste your comma-separated data here!"></textarea>

<div id="demo">
<p>Click the button below to find the best model for your data.</p>
<button type="button" onclick="send_post_request()">Fit Data</button>
</div>

<br>

<div id="response_text">
<p>No requests yet</p>
</div>
<img id="response_image" src="https://ingliswhalen.files.wordpress.com/2023/11/64862-splash.png">


<script>
var response_image;
var response_text;

function extract_image(response){
    yourByteArrayAsBase64 = response.base64_img;
    //yourByteArrayAsBase64 = "iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=="
    //https://stackoverflow.com/questions/20756042/how-to-display-an-image-stored-as-byte-array-in-html-javascript
    return "data:image/png;base64," + yourByteArrayAsBase64;
}

function extract_text(response){
    return response['res_str'];
}

function send_post_request() {

  const data = document.getElementById("text_area").value;



  const xhttp = new XMLHttpRequest();
  xhttp.open("POST", "/fit_data");
  xhttp.setRequestHeader("Content-Type", "application/json");
  xhttp.onload = function() {
    console.log(xhttp.responseText);
    let json_data = JSON.parse(xhttp.responseText)
    document.getElementById("response_image").src = extract_image(json_data);
    document.getElementById("response_text").innerHTML = "<pre>" + extract_text(json_data) + "</pre>";
  }
  xhttp.send(data);
}
</script>

</body>
</html>
